
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // User Profiles
    match /users/{userId} {
      // Users can only read/write their own profile
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Articles / Posts
    match /articles/{articleId} {
      // 1. Public Access: Anyone can read if the article is NOT premium
      allow read: if resource.data.isPremium == false;
      
      // 2. Pro/Admin Access: 
      // Checks for 'role' OR 'Role' field, and accepts 'admin'/'pro' OR 'Admin'/'Pro'
      allow read: if request.auth != null && (
         get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role in ['pro', 'admin'] ||
         get(/databases/$(database)/documents/users/$(request.auth.uid)).data.Role in ['Pro', 'Admin']
      );
      
      // 3. Admin Write Access
      allow write: if request.auth != null && (
          get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin' ||
          get(/databases/$(database)/documents/users/$(request.auth.uid)).data.Role == 'Admin'
      );
    }
  }
}
